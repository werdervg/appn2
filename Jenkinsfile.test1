node{
    stage ("Get Maven version") {
		sh 'ls /var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/ > maven.txt'
		sh 'cat maven.txt'
		Maven_Version = readFile 'maven.txt'
		GIT_SOURCE = 'https://github.com/werdervg/start.git'
	}
}
pipeline {
	environment {
		registry = 'registry.mydomain.com:5000'
		registryCredential = 'admin'
		dockerImage = ''			
	}
agent any
  parameters {
    choice(
        name: 'MavenVersion',
        choices: "${Maven_Version}",
        description: 'On this step you need select Maven Version' )
	}
stages {
	stage('Build With maven 3.6.3') {
		when {
			expression { params.MavenVersion == 'maven_3.6.3' }
		}
		steps {
			sh '"/var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/maven_3.6.3/bin/mvn" -Dmaven.test.failure.ignore clean package'
			sh 'cp target/*.jar app.jar'
		}
	}
	stage('Build With maven 2.2.1') {
		when {
			expression { params.MavenVersion == 'maven_2.2.1' }
		}
		steps {
			sh '"/var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/maven_2.2.1/bin/mvn" -Dmaven.test.failure.ignore clean package'
			sh 'cp target/*.jar app.jar'
		}
	}
	stage('Building image') {
		steps{
			script {
				dockerImage = docker.build registry + "/$JOB_NAME" + ":v$BUILD_NUMBER"
			}
		}
	}

	stage('Remove Unused docker image') {
		steps{
			sh "docker rmi $registry/$JOB_NAME:$BUILD_NUMBER"
		}
	}
}
}
